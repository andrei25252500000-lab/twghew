<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        body { overflow: hidden; width:100vw; height:100vh; position:fixed; background:#000; font-family: Arial, sans-serif; color:#fff; }
        .fullscreen-image { width:100%; height:100vh; object-fit:cover; position:absolute; top:0; left:0; opacity:0; transition:opacity .5s ease; }
        .fullscreen-image.active{ opacity:1; }
        .bottom-image{ position:absolute; bottom:20px; left:50%; transform:translateX(-50%); max-width:90%; height:auto; opacity:0; pointer-events:none; transition:opacity .5s ease; z-index:10; }
        .bottom-image.show{ opacity:1; }
        .center-image{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:40vw; height:auto; max-width:200px; opacity:0; z-index:20; transition:opacity .5s ease; }
        .center-image.show{ opacity:1; }
        .bottom-right-image{ position:absolute; bottom:20px; right:20px; width:30vw; max-width:150px; height:auto; opacity:0; pointer-events:none; transition:opacity .5s ease; z-index:15; }
        .bottom-right-image.show{ opacity:1; }
        html { touch-action: manipulation; }

        /* Модальное окно настроек / логина */
        .modal-backdrop { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:100; display:flex; align-items:center; justify-content:center; }
        .modal { width:92%; max-width:420px; background:#111; border-radius:12px; padding:16px; box-shadow:0 8px 30px rgba(0,0,0,0.6); color:#fff; }
        .modal h2 { font-size:18px; margin-bottom:8px; text-align:center; }
        .field { margin:8px 0; display:flex; flex-direction:column; }
        .field label { font-size:12px; margin-bottom:6px; color:#bbb; }
        .field input { padding:10px; border-radius:8px; border:1px solid #333; background:#0f0f0f; color:#fff; font-size:14px; outline:none; }
        .btn { margin-top:10px; padding:10px; width:100%; border-radius:8px; background:#1e88e5; color:#fff; border:none; font-weight:700; cursor:pointer; }
        .small { font-size:12px; color:#aaa; margin-top:6px; text-align:center; }
        .top-left-promo { position:fixed; top:12px; left:12px; z-index:110; background:rgba(0,0,0,0.6); padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); font-size:13px; }
        .admin-panel { margin-top:10px; padding:10px; background:#0b0b0b; border-radius:8px; }
        .account-list { max-height:160px; overflow:auto; margin-top:8px; font-size:13px; color:#ddd; }
        .token-show { word-break:break-all; font-size:12px; background:#0a0a0a; padding:6px; border-radius:6px; margin-top:8px; }

        /* мелкие адаптации */
        @media (max-width:420px){
            .modal { padding:12px; border-radius:10px; }
            .center-image { width:50vw; max-width:160px; }
        }
    </style>
</head>
<body>
    <!-- Изображения -->
    <img src="https://i.ibb.co/V0XsFLdM/photo-2026-01-02-13-46-34.jpg" class="fullscreen-image active" id="bg-image">
    <img src="https://i.ibb.co/v62RsZJ9/photo-2026-01-02-14-27-05-removebg-preview.png" class="bottom-image" id="floating-image">
    <img src="https://bogatyr.club/uploads/posts/2023-03/23416/thumbs/1678841553_bogatyr-club-p-fon-bravla-starsa-foni-pinterest-18.jpg" class="fullscreen-image" id="third-image">
    <img src="https://i.ibb.co/nst0DTwZ/3-F3-F-Skin-Default-Old.webp" class="center-image" id="shelly-image">
    <img src="https://i.ibb.co/vCmqDYzN/photo-2026-01-02-20-09-17-removebg-preview.png" class="bottom-right-image" id="new-image">

    <!-- Верхний левый промокод (показывается после модалки) -->
    <div id="promoDisplay" class="top-left-promo" style="display:none;">
        Промокод: <b id="promoCodeText"></b>
        <div style="margin-top:6px;">
            <input id="promoInput" placeholder="Введите промокод" style="padding:6px;border-radius:6px;background:#0b0b0b;border:1px solid #222;color:#fff;font-size:13px;" />
            <button id="applyPromoBtn" style="margin-top:6px;padding:6px;border-radius:6px;border:none;background:#2e7d32;color:#fff;cursor:pointer;">Применить</button>
            <div id="promoMsg" style="font-size:12px;margin-top:6px;color:#ccc;"></div>
        </div>
    </div>

    <!-- Модалка регистрации / логина (обязательная) -->
    <div id="setupModal" class="modal-backdrop" style="display:none;">
        <div class="modal">
            <h2>Создай аккаунт / войди (обязательно)</h2>

            <div id="signupBlock">
                <div class="field"><label>Ник</label><input id="signupNick" placeholder="ник (например: Player1)" /></div>
                <div class="field"><label>Пароль</label><input id="signupPass" type="password" placeholder="пароль" /></div>
                <button id="signupBtn" class="btn">Создать аккаунт</button>
                <div class="small">Или войди ниже, если аккаунт уже есть</div>
            </div>

            <hr style="margin:10px 0;border-color:#222"/>

            <div id="loginBlock">
                <div class="field"><label>Ник</label><input id="loginNick" placeholder="ник" /></div>
                <div class="field"><label>Пароль</label><input id="loginPass" type="password" placeholder="пароль" /></div>
                <button id="loginBtn" class="btn">Войти</button>
            </div>

            <div style="margin-top:10px;">
                <div class="small">После создания аккаунта токен будет присвоен и сохранён на этом устройстве.</div>
            </div>
        </div>
    </div>

    <!-- Админ-панель (появляется после ввода админ-пароля) -->
    <div id="adminModal" class="modal-backdrop" style="display:none;">
        <div class="modal">
            <h2>Админ-панель</h2>
            <div class="admin-panel">
                <div class="field"><label>Логин игрока (кому выдать гемы)</label><input id="adminTarget" placeholder="ник игрока" /></div>
                <div class="field"><label>Количество гемов</label><input id="adminAmount" type="number" placeholder="например 100" /></div>
                <button id="giveBtn" class="btn">Выдать</button>
                <div id="adminMsg" style="margin-top:8px;color:#ccc;font-size:13px;"></div>

                <div style="margin-top:10px;">
                    <div class="small">Список аккаунтов (локально):</div>
                    <div id="accountList" class="account-list"></div>
                </div>

                <div style="margin-top:8px">
                    <button id="closeAdmin" class="btn" style="background:#9e9e9e;">Закрыть админку</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // элементы
            const floatingImage = document.getElementById('floating-image');
            const bgImage = document.getElementById('bg-image');
            const thirdImage = document.getElementById('third-image');
            const shellyImage = document.getElementById('shelly-image');
            const newImage = document.getElementById('new-image');

            const setupModal = document.getElementById('setupModal');
            const promoDisplay = document.getElementById('promoDisplay');
            const promoCodeText = document.getElementById('promoCodeText');
            const promoInput = document.getElementById('promoInput');
            const applyPromoBtn = document.getElementById('applyPromoBtn');
            const promoMsg = document.getElementById('promoMsg');

            const signupNick = document.getElementById('signupNick');
            const signupPass = document.getElementById('signupPass');
            const signupBtn = document.getElementById('signupBtn');
            const loginNick = document.getElementById('loginNick');
            const loginPass = document.getElementById('loginPass');
            const loginBtn = document.getElementById('loginBtn');

            const adminModal = document.getElementById('adminModal');
            const adminTarget = document.getElementById('adminTarget');
            const adminAmount = document.getElementById('adminAmount');
            const giveBtn = document.getElementById('giveBtn');
            const adminMsg = document.getElementById('adminMsg');
            const accountList = document.getElementById('accountList');
            const closeAdmin = document.getElementById('closeAdmin');

            // простая конфигурация (замени adminPass на свой, если нужно)
            const ADMIN_PASSWORD = 'admin123'; // обязательно поменяй на что-то своё если будешь использовать
            const PROMO_CODES = { 'PROMO2026': 200 }; // код => количество гемов
            // локальное хранилище ключи
            const LS_ACCOUNTS = 'bs_accounts_v1'; // объект: {nick: {passHash, gems, token, createdAt}}
            const LS_SETUP_DONE = 'bs_setup_done_v1';
            const LS_USED_PROMOS = 'bs_used_promos_v1'; // массив использованных кодов глобально

            // Вспомогательные функции
            function loadAccounts() {
                try { return JSON.parse(localStorage.getItem(LS_ACCOUNTS) || '{}'); }
                catch(e){ return {}; }
            }
            function saveAccounts(obj) { localStorage.setItem(LS_ACCOUNTS, JSON.stringify(obj)); }
            function loadUsedPromos() {
                try { return JSON.parse(localStorage.getItem(LS_USED_PROMOS) || '[]'); }
                catch(e){ return []; }
            }
            function saveUsedPromos(arr) { localStorage.setItem(LS_USED_PROMOS, JSON.stringify(arr)); }
            function setSetupDone() { localStorage.setItem(LS_SETUP_DONE, '1'); }
            function isSetupDone() { return localStorage.getItem(LS_SETUP_DONE) === '1'; }

            function hashSimple(s) {
                // простая (небезопасная) хэш-функция только чтобы не хранить пароль в чистом виде
                let h = 2166136261 >>> 0;
                for (let i=0;i<s.length;i++){ h = Math.imul(h ^ s.charCodeAt(i), 16777619); }
                return (h >>> 0).toString(16);
            }

            function genToken(len = 32) {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let t = '';
                for (let i=0;i<len;i++) t += chars.charAt(Math.floor(Math.random()*chars.length));
                return t;
            }

            function showSetupModal() {
                setupModal.style.display = 'flex';
            }
            function hideSetupModal() {
                setupModal.style.display = 'none';
            }

            function showPromoDisplay(code) {
                promoCodeText.textContent = code;
                promoDisplay.style.display = 'block';
            }

            function showAdminModal() {
                fillAccountList();
                adminModal.style.display = 'flex';
            }
            function hideAdminModal() {
                adminModal.style.display = 'none';
            }

            function fillAccountList() {
                const acc = loadAccounts();
                let html = '';
                for (const k in acc) {
                    html += `<div>${k} — гемы: ${acc[k].gems} — токен: <span class="token-show">${acc[k].token}</span></div>`;
                }
                if (!html) html = '<div style="color:#777">Пока нет аккаунтов</div>';
                accountList.innerHTML = html;
            }

            // Логика создания/входа
            signupBtn.addEventListener('click', function() {
                const nick = signupNick.value.trim();
                const pass = signupPass.value;
                if (!nick || !pass) { alert('Нужно заполнить ник и пароль.'); return; }
                const accounts = loadAccounts();
                if (accounts[nick]) { alert('Этот ник уже занят. Войдите или выберите другой.'); return; }
                const token = genToken(40);
                accounts[nick] = { passHash: hashSimple(pass), gems: 0, token: token, createdAt: Date.now() };
                saveAccounts(accounts);
                localStorage.setItem('bs_current_user', nick);
                setSetupDone();
                hideSetupModal();
                promoMsg.textContent = 'Аккаунт создан. Токен присвоен.';
                showPromoDisplay(Object.keys(PROMO_CODES)[0] || '');
                // тут можешь продолжить скрипт игры...
                onUserReady(nick);
            });

            loginBtn.addEventListener('click', function() {
                const nick = loginNick.value.trim();
                const pass = loginPass.value;
                if (!nick || !pass) { alert('Заполни ник и пароль.'); return; }
                const accounts = loadAccounts();
                if (!accounts[nick] || accounts[nick].passHash !== hashSimple(pass)) { alert('Неверный ник или пароль.'); return; }
                localStorage.setItem('bs_current_user', nick);
                setSetupDone();
                hideSetupModal();
                promoMsg.textContent = 'Вход выполнен.';
                showPromoDisplay(Object.keys(PROMO_CODES)[0] || '');
                onUserReady(nick);
            });

            // Применение промокода (глобально одноразово)
            applyPromoBtn.addEventListener('click', function() {
                const code = promoInput.value.trim();
                if (!code) { promoMsg.textContent = 'Введи код.'; return; }
                const used = loadUsedPromos();
                if (used.includes(code)) { promoMsg.textContent = 'Этот код уже использован.'; return; }
                if (!PROMO_CODES.hasOwnProperty(code)) { promoMsg.textContent = 'Неверный промокод.'; return; }
                const current = localStorage.getItem('bs_current_user');
                if (!current) { promoMsg.textContent = 'Сначала войди в аккаунт.'; return; }
                const accounts = loadAccounts();
                accounts[current].gems = (accounts[current].gems || 0) + PROMO_CODES[code];
                saveAccounts(accounts);
                used.push(code);
                saveUsedPromos(used);
                promoMsg.textContent = `Код применён: +${PROMO_CODES[code]} гемов.`;
                fillAccountList();
            });

            // Админ: чтобы открыть, нужно ввести админ-пароль через prompt (появляется после модалки)
            document.addEventListener('keydown', function(e){
                // сочетание: Ctrl+Shift+A открывает админку (на телефоне можно вызвать через кнопку/скрипт)
                if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'a') {
                    const p = prompt('Введи админ-пароль:');
                    if (p === ADMIN_PASSWORD) {
                        showAdminModal();
                    } else alert('Неверный админ-пароль.');
                }
            });

            giveBtn.addEventListener('click', function() {
                const target = adminTarget.value.trim();
                const amt = parseInt(adminAmount.value, 10);
                if (!target || isNaN(amt) || amt <= 0) { adminMsg.textContent = 'Неправильные данные.'; return; }
                const accounts = loadAccounts();
                if (!accounts[target]) { adminMsg.textContent = 'Такого игрока нет.'; return; }
                accounts[target].gems = (accounts[target].gems || 0) + amt;
                saveAccounts(accounts);
                adminMsg.textContent = `Выдано ${amt} гемов игроку ${target}. Сейчас: ${accounts[target].gems}.`;
                fillAccountList();
            });

            closeAdmin.addEventListener('click', function(){ hideAdminModal(); });

            // Сценарий показа картинок + обязательной формы
            var randomDelay = 2000 + Math.random() * 2000;
            setTimeout(function() {
                floatingImage.classList.add('show');
                setTimeout(function() {
                    thirdImage.classList.add('active');
                    bgImage.classList.remove('active');
                    floatingImage.classList.remove('show');
                    shellyImage.classList.add('show');
                    newImage.classList.add('show');

                    // после показа первой / второй картинки — показать модалку если ещё не было setup
                    if (!isSetupDone()) {
                        showSetupModal();
                    } else {
                        // если уже было — показать промо и установить текущего юзера
                        const cur = localStorage.getItem('bs_current_user');
                        if (cur) { promoMsg.textContent = 'Привет, ' + cur; }
                        showPromoDisplay(Object.keys(PROMO_CODES)[0] || '');
                        onUserReady(cur);
                    }
                }, 2000);
            }, randomDelay);

            // предотвращения жестов
            document.addEventListener('touchstart', function(e) { if(e.touches.length > 1) e.preventDefault(); }, { passive:false });
            document.addEventListener('contextmenu', function(e){ e.preventDefault(); });

            // когда пользователь готов — можно продолжать "скрипт" игры
            function onUserReady(nick) {
                // пример: показать токен и гемы в консоли и в промо-блоке
                if (!nick) return;
                const accounts = loadAccounts();
                const user = accounts[nick];
                if (!user) return;
                promoMsg.textContent = `Игрок: ${nick} — гемы: ${user.gems}`;
                // токен можно показать в alert или куда нужно
                console.log('Токен пользователя', nick, user.token);
            }

            // небольшая подсказка: чтобы открыть админку на телефоне, можно вызвать этот код в консоли:
            // localStorage.setItem('bs_admin_shortcut','1'); then press Ctrl+Shift+A (desktop) or implement свой способ.
            // Но т.к. на телефоне Ctrl+Shift+A нет — просто дать пользователю знать:
            // Добавим явную кнопку (скрытую) для телефонов: двойной тап в правом верхнем углу откроет запрос админ-пароля.
            let tapCount = 0;
            document.addEventListener('touchend', function(e){
                const x = e.changedTouches[0].clientX;
                const y = e.changedTouches[0].clientY;
                if (x > window.innerWidth - 80 && y < 120) {
                    tapCount++;
                    setTimeout(()=>{ tapCount=0; }, 800);
                    if (tapCount >= 2) {
                        const p = prompt('Введи админ-пароль:');
                        if (p === ADMIN_PASSWORD) showAdminModal(); else alert('Неверный админ-пароль.');
                        tapCount = 0;
                    }
                }
            });

            // на всякий случай — создаём demo промокоды/данные если нет
            if (!localStorage.getItem(LS_USED_PROMOS)) saveUsedPromos([]);
            if (!localStorage.getItem(LS_ACCOUNTS)) saveAccounts({});

        });
    </script>
</body>
</html>
